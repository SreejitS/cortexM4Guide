/**
 ******************************************************************************
 * @file    main.c
 * @author  Auto-generated by STM32CubeIDE
 * @version V1.0
 * @brief   Default main function.
 ******************************************************************************
 */

#if !defined(__SOFT_FP__) && defined(__ARM_FP)
  #warning "FPU is not initialized, but the project is compiling for an FPU. Please initialize the FPU before use."
#endif

#include <stdio.h>

void task_handler1(void);
void task_handler2(void);
void task_handler3(void);
void task_handler4(void);

void init_systick_timer(uint32_t tick_hz);

//stack memory defines
/*
 *	SRAM :-
 *
 * -----------------------------------------------------------------------
 * |							|  SCED	 |	T4	 |	T3	 |	T2	 |	T1	 |
 * |							| stack	 | stack | stack | stack | stack |
 * |							|  1KB	 |	1KB	 |	1KB	 |	1KB	 |	1KB	 |
 * |							|		 |		 |		 |		 |		 |
 * -----------------------------------------------------------------------
 * 0x20000000															0x20018000 (96KB of SRAM)
 *
 *
 * */

#define SIZE_TASK_STACK 		1024U
#define SIZE_SCHEDULER_STACK	1024U

#define SRAM_START				0x20000000U
#define SRAM_SIZE				( (96) * (1024))
#define SRAM_END				( (SRAM_START) + (SRAM_SIZE) )

#define T1_STACK_START			(SRAM_END)
#define T2_STACK_START			( (SRAM_END) - (1 * SIZE_TASK_STACK) )
#define T3_STACK_START			( (SRAM_END) - (2 * SIZE_TASK_STACK) )
#define T4_STACK_START			( (SRAM_END) - (3 * SIZE_TASK_STACK) )
#define SCHED_STACK_START		( (SRAM_END) - (4 * SIZE_TASK_STACK) )

#define TICK_HZ					1000U

#define CLOCK					4000000U
#define SYSTICK_TIM_CLK			CLOCK

int main(void) {
	init_systick_timer(TICK_HZ);
	for (;;)
		;
}

void task_handler1(void) {
	while (1) {
		printf("Hola from TASK 1\n");
	}
}

void task_handler2(void) {
	while (1) {
		printf("Hola from TASK 2\n");
	}
}

void task_handler3(void) {
	while (1) {
		printf("Hola from TASK 3\n");
	}
}

void task_handler4(void) {
	while (1) {
		printf("Hola from TASK 4\n");
	}
}

void init_systick_timer(uint32_t tick_hz) {

	uint32_t *pSRVR = (uint32_t* )0xE000E014; //SysTick Reload Value Register
	uint32_t *pSCSR = (uint32_t* )0xE000E010; //SysTick Control and Status Register

	uint32_t count_value = SYSTICK_TIM_CLK / tick_hz - 1;

	//clear n load the value into SVR
	*pSRVR = ~(0x00FFFFFF);
	*pSRVR |= count_value;

	*pSCSR |= (1 << 1); //Enables SysTick exception request
	*pSCSR |= (1 << 2); //clock source = processor clock

	*pSCSR |= (1 << 0); //enable systick




}

void SysTick_Handler(void) {

}
